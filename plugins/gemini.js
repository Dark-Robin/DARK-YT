const {cmd , commands} = require('../command')
const axios = require("axios")
const config = require('../config');

const GEMINI_API_KEY = config.GEMINI_API_KEY;  //REPLACE WITH YOUR API KEY OF GEMINI
const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`;

cmd({
  pattern: "gemini",
  alias: ["ai","chatgpt"],
  react: 'ü§ñ',
  desc: "Ask anything to Google Gemini AI.",
  category: "ai",
  use: ".gemini <Your Quoestion>",
  filename: __filename
}, async (conn, mek, msg, { from, quoted, body, isCmd, command, args, q, isGroup, sender, senderNumber, botNumber2, botNumber, pushname, isMe, isOwner, groupMetadata, groupName, participants, groupAdmins, isBotAdmins, isAdmins, reply }) => {
  try {
    const text = args.join(" ");
    if (!text) {
      return reply(`‚ùóÔ∏è Please GFive Me A Question`);
    }

    const prompt = `‡∂∏‡∂∏ ${pushname}, ‡∂∏‡∂∏ ‡∂Ö‡∑É‡∂± ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± ‡∑Ä‡∂Ω‡∂ß ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∂∫ ‡∂Ö‡∑É‡∂± ‡∂∑‡∑è‡∑Å‡∑è‡∑Ä‡∑ô‡∂±‡∑ä ‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂Ø‡∑ô‡∂±‡∑ä‡∂±. ‡∂î‡∂∂‡∑ö ‡∂±‡∂∏ Robin AI. ‡∂î‡∂∂ WhatsApp AI Bot ‡∂ö‡∑ô‡∂±‡∑ô‡∂ö‡∑ä. ‡∂î‡∂∂‡∑Ä ‡∑Ñ‡∑ê‡∂Ø‡∑î‡∑Ä‡∑ö Isara Sihilel ‡∂ö‡∑í‡∂∫‡∂± ‡∂ö‡∑ô‡∂±‡∑ô‡∂ö‡∑ä. ‡∑É‡∑í‡∂≠‡∂±‡∑ä‡∂± ‡∂î‡∂∂ ‡∂≠‡∂ª‡∑î‡∂´ ‡∂ö‡∑ú‡∂Ω‡∑ä‡∂Ω‡∑ô‡∂ö‡∑ä ‡∂ö‡∑í‡∂∫‡∂Ω ‡∑Ñ‡∑í‡∂≠‡∂Ω ‡∂ë‡∂∏ ‡∂∑‡∑è‡∑Ç‡∑è‡∑Ä‡∑ô‡∂±‡∑ä ‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂Ø‡∑ô‡∂±‡∑ä‡∂±. Funny ‡∑Ä‡∑ô‡∂±‡∑ä‡∂±, ‡∂î‡∂∂ bot ‡∂ö‡∑ô‡∂±‡∑ô‡∂ö‡∑ä ‡∂ö‡∑í‡∂∫‡∂Ω ‡∑Ñ‡∑í‡∂≠‡∂±‡∑ä‡∂± ‡∂∂‡∑ê‡∂ª‡∑í ‡∑Ä‡∑í‡∂Ø‡∑í‡∑Ñ‡∂ß ‡∑É‡∑ê‡∂∂‡∑ë ‡∂∏‡∂±‡∑î‡∑É‡∑ä‡∑É‡∂∫‡∑ô‡∂ö‡∑ä ‡∂ö‡∑í‡∂∫‡∂Ω ‡∑Ñ‡∑í‡∂≠‡∂±‡∑ä ‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂Ø‡∑ô‡∂±‡∑ä‡∂±. Use meaningful emojies. ‡∂∏‡∂ú‡∑ö ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∂∫: ${text}`;

    const payload = {
      contents: [{
        parts: [{ text: prompt }]
      }]
    };

    const response = await axios.post(
      GEMINI_API_URL,
      payload,
      {
        headers: {
          "Content-Type": "application/json",
        },
      }
    );

    if (!response.data || !response.data.candidates || !response.data.candidates[0]?.content?.parts) {
      return reply("‚ùå Gemini AI ‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂Ω‡∂∂‡∑è ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏‡∂ß ‡∂Ö‡∑É‡∂∏‡∂≠‡∑ä ‡∑Ä‡∑í‡∂∫. üò¢");
    }
    
    const aiResponse = response.data.candidates[0].content.parts[0].text;
    await reply(`${aiResponse}`);
  } catch (error) {
    console.error("Error:", error.response?.data || error.message);
    reply("‚ùå ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∂∫ ‡∑É‡∑ê‡∂ö‡∑É‡∑ì‡∂∏‡∑ö‡∂Ø‡∑ì ‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä ‡∂á‡∂≠‡∑í ‡∑Ä‡∑í‡∂∫. üò¢");
  }
});
